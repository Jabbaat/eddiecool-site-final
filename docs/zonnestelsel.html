<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fotorealistisch 3D Zonnestelsel</title>
    <!-- Importeer Three.js en OrbitControls -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/TextureLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/objects/Lensflare.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; }
        #canvas-container { width: 100vw; height: 100vh; cursor: grab; }
        #canvas-container:active { cursor: grabbing; }
        .ui-panel {
            position: absolute; z-index: 100; background: rgba(0, 0, 0, 0.8);
            padding: 20px; border-radius: 15px; backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.3); box-shadow: 0 0 25px rgba(255, 215, 0, 0.1);
        }
        .controls { top: 20px; left: 20px; }
        .planet-info { top: 20px; right: 20px; max-width: 320px; max-height: calc(100vh - 40px); overflow-y: auto;}
        .navigation-help { bottom: 20px; left: 20px; padding: 15px; }
        .ui-panel h3, .ui-panel h4 { color: #ffd700; margin-bottom: 15px; font-weight: 600; }
        .control-group { margin: 15px 0; }
        .control-group label { display: block; margin-bottom: 8px; color: #ccc; font-size: 14px; }
        .control-group input[type="range"] { width: 220px; }
        .loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #ffd700; font-size: 24px; z-index: 1000;
        }
        #planetDetails h4 { margin: 0 0 10px 0; font-size: 20px; }
        #planetDetails p { margin: 0; line-height: 1.5; font-size: 15px; }
        .label {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            text-shadow: 0 0 5px #000;
            font-size: 16px;
            z-index: 101;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">Zonnestelsel wordt geladen...</div>
    <div id="canvas-container"></div>
    <div class="ui-panel controls">
        <h3>üöÄ Zonnestelsel Controles</h3>
        <div class="control-group">
            <label>Simulatiesnelheid: <span id="speedValue">1.0x</span></label>
            <input type="range" id="speedControl" min="0" max="10" step="0.1" value="1">
        </div>
        <div class="control-group">
            <label><input type="checkbox" id="showOrbits" checked> Toon banen</label>
        </div>
        <div class="control-group">
            <label><input type="checkbox" id="showNames" checked> Toon namen</label>
        </div>
    </div>
    <div class="ui-panel planet-info">
        <h3>ü™ê Hemellichaam Info</h3>
        <div id="planetDetails">Klik op een hemellichaam voor leuke weetjes.</div>
    </div>
    <div class="ui-panel navigation-help">
        <h4>‚å®Ô∏è Navigatie</h4>
        <p>üñ±Ô∏è Linkermuisknop: Roteer camera</p>
        <p>üñ±Ô∏è Rechtermuisknop: Pan camera</p>
        <p>‚ö™ Scroll: Zoom in/uit</p>
        <p>‚å®Ô∏è Spatie: Pauzeer/start</p>
    </div>

    <script>
        // Globale variabelen
        let scene, camera, renderer, controls;
        let sun, sunLight;
        let celestialObjects = [];
        let orbits = [];
        let labels = [];
        let asteroids = [];
        let animationSpeed = 1;
        let isPaused = false;
        const textureLoader = new THREE.TextureLoader();

        // Data voor de hemellichamen met realistische texturen en uitgebreide info
        const celestialData = [
            { name: 'Mercurius', distance: 15, size: 0.8, tilt: 0.03, color: 0x8C7853, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_mercury.jpg', speed: 4.74, rotationSpeed: 0.01, facts: 'Mercurius is de kleinste planeet en staat het dichtst bij de zon. Het oppervlak is bezaaid met kraters, vergelijkbaar met onze maan. Overdag kan de temperatuur oplopen tot een verzengende 430¬∞C, terwijl het \'s nachts kan dalen tot -180¬∞C. Een dag op Mercurius duurt langer dan een jaar!' },
            { name: 'Venus', distance: 20, size: 1.2, tilt: 177.0, color: 0xFFB649, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_venus_surface.jpg', speed: 3.50, rotationSpeed: -0.007, facts: 'Venus wordt vaak de "zusterplaneet" van de Aarde genoemd vanwege haar vergelijkbare grootte. Het is echter een helse wereld met een extreem dichte atmosfeer van koolstofdioxide, wat leidt tot een op hol geslagen broeikaseffect. De oppervlaktetemperatuur is constant rond de 465¬∞C, heet genoeg om lood te smelten.' },
            { name: 'Aarde', distance: 25, size: 1.3, tilt: 23.44, color: 0x6B93D6, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_earth_daymap.jpg', speed: 2.98, rotationSpeed: 0.02, facts: 'Onze thuisplaneet, de Aarde, is de enige bekende plek in het universum met leven. Het is een unieke wereld met vloeibaar water, een zuurstofrijke atmosfeer en een beschermend magnetisch veld. De diversiteit van het leven en de geologische activiteit maken het een constant veranderende en dynamische planeet.', atmosphere: true },
            { name: 'Mars', distance: 30, size: 1.0, tilt: 25.19, color: 0xCD5C5C, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_mars.jpg', speed: 2.41, rotationSpeed: 0.018, facts: 'De "Rode Planeet" dankt zijn kleur aan ijzeroxide (roest) in de bodem. Mars herbergt de hoogste vulkaan (Olympus Mons) en de diepste canyon (Valles Marineris) in het zonnestelsel. Er is sterk bewijs dat er ooit vloeibaar water op het oppervlak was, wat het een interessante kandidaat maakt in de zoektocht naar vroeger leven.' },
            { name: 'Jupiter', distance: 45, size: 4.0, tilt: 3.13, color: 0xD2691E, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_jupiter.jpg', speed: 1.31, rotationSpeed: 0.04, facts: 'Jupiter is de onbetwiste koning van ons zonnestelsel; hij is groter dan alle andere planeten bij elkaar. Deze gasreus heeft geen vast oppervlak en is bekend om zijn Grote Rode Vlek, een gigantische storm die al eeuwen woedt. Jupiter heeft tientallen manen, waaronder de vier grote Galile√Øsche manen.' },
            { name: 'Saturnus', distance: 60, size: 3.5, tilt: 26.73, color: 0xFAB552, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_saturn.jpg', speed: 0.97, rotationSpeed: 0.038, facts: 'Saturnus is het juweel van het zonnestelsel, beroemd om zijn spectaculaire ringenstelsel. Deze ringen bestaan uit miljarden stukjes ijs en rots. De planeet zelf is een gasreus en heeft de laagste dichtheid van alle planeten; hij zou op water drijven als je een badkuip groot genoeg kon vinden!' },
            { name: 'Uranus', distance: 75, size: 2.5, tilt: 97.77, color: 0x4FD0E7, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_uranus.jpg', speed: 0.68, rotationSpeed: 0.03, facts: 'Uranus is een ijsreus en uniek omdat hij op zijn kant roteert, waarschijnlijk als gevolg van een enorme botsing in het verleden. Dit zorgt voor extreme seizoenen, waarbij elke pool 42 jaar lang in duisternis of zonlicht baadt. De blauwgroene kleur wordt veroorzaakt door methaan in de atmosfeer.' },
            { name: 'Neptunus', distance: 90, size: 2.4, tilt: 28.32, color: 0x4169E1, texture: 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_neptune.jpg', speed: 0.54, rotationSpeed: 0.032, facts: 'Neptunus is de verste planeet van de zon en een donkere, koude wereld. Deze ijsreus heeft de snelste winden in het zonnestelsel, met snelheden tot wel 2.100 km/u. Hij werd in 1846 ontdekt, niet door observatie, maar door wiskundige voorspellingen gebaseerd op de baan van Uranus.' },
            { name: 'Pluto', type: 'dwarf', distance: 105, size: 0.5, tilt: 122.53, color: 0xD3BBAF, texture: 'https://raw.githubusercontent.com/dev-SR/planets-3d/master/images/pluto.jpg', speed: 0.47, rotationSpeed: 0.005, facts: 'Eens de negende planeet, nu geclassificeerd als dwergplaneet. Pluto is een complexe en ijzige wereld in de Kuipergordel. Hij heeft bergen van waterijs, gletsjers van stikstof en een dunne atmosfeer. Zijn grootste maan, Charon, is zo groot dat ze samen een dubbel-planetenstelsel vormen.' }
        ];
        const sunFacts = 'De Zon is het hart van ons zonnestelsel. Deze gele dwergster bevat 99,8% van alle massa. In haar kern zet kernfusie waterstof om in helium, waarbij een onvoorstelbare hoeveelheid energie vrijkomt die licht en warmte door het hele zonnestelsel stuurt.';

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 3000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000005);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 20;
            controls.maxDistance = 500;

            addStars();
            createSun();
            createCelestialBodies();
            createAsteroidBelt();

            camera.position.set(0, 80, 150);
            controls.update();

            setupEventListeners();
            document.getElementById('loading').style.display = 'none';
            animate();
        }

        function addStars() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = THREE.MathUtils.randFloatSpread(2500);
                const y = THREE.MathUtils.randFloatSpread(2500);
                const z = THREE.MathUtils.randFloatSpread(2500);
                starsVertices.push(x, y, z);
            }
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starsMaterial = new THREE.PointsMaterial({ color: 0xAAAAAA, size: 0.7 });
            scene.add(new THREE.Points(starsGeometry, starsMaterial));
        }

        // GECORRIGEERD: Robuustere manier om de zon textuur te laden
        function createSun() {
            const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xFFD700 });
            
            textureLoader.load(
                'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_sun.jpg',
                (texture) => { // onSuccess
                    sunMaterial.map = texture;
                    sunMaterial.color.set(0xffffff);
                    sunMaterial.needsUpdate = true;
                },
                undefined, // onProgress
                (err) => { // onError
                    console.error('Kon zon textuur niet laden, fallback naar kleur.', err);
                }
            );

            sun = new THREE.Mesh(new THREE.SphereGeometry(7, 64, 64), sunMaterial);
            celestialObjects.push(sun);
            scene.add(sun);

            sunLight = new THREE.PointLight(0xffffff, 2, 3000);
            scene.add(sunLight);
            
            const flareTexture = textureLoader.load('https://threejs.org/examples/textures/lensflare/lensflare0.png');
            const lensflare = new THREE.Lensflare();
            lensflare.addElement(new THREE.LensflareElement(flareTexture, 700, 0, sunLight.color));
            sunLight.add(lensflare);
        }

        function createCelestialBodies() {
            celestialData.forEach(data => {
                const material = new THREE.MeshStandardMaterial({ color: data.color });
                const planet = new THREE.Mesh(new THREE.SphereGeometry(data.size, 32, 32), material);
                
                textureLoader.load(data.texture,
                    (texture) => { // onSuccess
                        planet.material.map = texture;
                        planet.material.color.set(0xffffff);
                        planet.material.needsUpdate = true;
                    },
                    undefined, // onProgress
                    (err) => { // onError
                        console.error(`Kon textuur niet laden voor ${data.name}:`, err);
                    }
                );
                
                planet.rotation.z = THREE.MathUtils.degToRad(data.tilt);
                planet.position.x = data.distance;
                planet.userData = { ...data, angle: Math.random() * Math.PI * 2, mesh: planet };
                scene.add(planet);
                celestialObjects.push(planet);

                createOrbit(data.distance, data.type === 'dwarf' ? 0x666666 : 0x333333);
                createLabel(data.name, planet, 0xFFFFFF);

                if (data.name === 'Saturnus') createSaturnRings(planet, data.size);
                if (data.name === 'Aarde') {
                    createMoon(planet, 3, 0.3, 'https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_moon.jpg', 20);
                    createAtmosphere(planet, data.size);
                }
                if (data.name === 'Mars') {
                    createMoon(planet, 2.0, 0.1, 0xAAAAAA, 30);
                    createMoon(planet, 2.8, 0.15, 0x999999, 45);
                }
            });
        }
        
        function createAtmosphere(parent, size) {
            const atmosphereMaterial = new THREE.MeshBasicMaterial({
                color: 0x6B93D6,
                transparent: true,
                opacity: 0.2,
                side: THREE.BackSide
            });
            const atmosphere = new THREE.Mesh(new THREE.SphereGeometry(size + 0.1, 32, 32), atmosphereMaterial);
            parent.add(atmosphere);
        }

        function createMoon(parent, distance, size, textureOrColor, speed) {
            let moonMaterial;
            if (typeof textureOrColor === 'string' && textureOrColor.startsWith('http')) {
                const moonTexture = textureLoader.load(textureOrColor);
                moonMaterial = new THREE.MeshStandardMaterial({ map: moonTexture });
            } else {
                moonMaterial = new THREE.MeshStandardMaterial({ color: textureOrColor });
            }
            const moon = new THREE.Mesh(new THREE.SphereGeometry(size, 16, 16), moonMaterial);
            moon.position.x = distance;
            parent.add(moon);
            
            if (!parent.userData.moons) parent.userData.moons = [];
            parent.userData.moons.push({ mesh: moon, distance: distance, speed: speed, angle: Math.random() * Math.PI * 2 });
        }

        function createAsteroidBelt() {
            const beltMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513, roughness: 0.8 });
            for (let i = 0; i < 1500; i++) {
                const size = Math.random() * 0.2 + 0.05;
                const asteroid = new THREE.Mesh(new THREE.DodecahedronGeometry(size, 0), beltMaterial);
                const angle = Math.random() * Math.PI * 2;
                const distance = 34 + Math.random() * 8;
                asteroid.position.set(Math.cos(angle) * distance, (Math.random() - 0.5) * 2, Math.sin(angle) * distance);
                asteroid.userData = { distance, angle, speed: (Math.random() * 0.2 + 0.8) * 1.5 };
                asteroids.push(asteroid);
                scene.add(asteroid);
            }
        }
        
        function createOrbit(distance, color) {
            const points = [];
            for (let i = 0; i <= 128; i++) {
                const angle = (i / 128) * Math.PI * 2;
                points.push(new THREE.Vector3(Math.cos(angle) * distance, 0, Math.sin(angle) * distance));
            }
            const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);
            const orbitMaterial = new THREE.LineBasicMaterial({ color: color, transparent: true, opacity: 0.5 });
            const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
            scene.add(orbit);
            orbits.push(orbit);
        }

        function createSaturnRings(planet, planetSize) {
            const ringTexture = textureLoader.load('https://raw.githubusercontent.com/TW-Team/space-viewer/main/src/assets/textures/2k_saturn_ring_alpha.png');
            const ringMaterial = new THREE.MeshBasicMaterial({ map: ringTexture, side: THREE.DoubleSide, transparent: true, opacity: 0.8 });
            const rings = new THREE.Mesh(new THREE.RingGeometry(planetSize + 0.5, planetSize + 3.5, 64), ringMaterial);
            rings.rotation.x = -Math.PI / 2;
            planet.add(rings);
        }

        function createLabel(text, object, color) {
            const div = document.createElement('div');
            div.className = 'label';
            div.textContent = text;
            div.style.color = `#${color.toString(16)}`;
            document.body.appendChild(div);
            labels.push({ div, object });
        }

        function setupEventListeners() {
            document.getElementById('speedControl').addEventListener('input', e => {
                animationSpeed = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = animationSpeed.toFixed(1) + 'x';
            });
            document.getElementById('showOrbits').addEventListener('change', e => orbits.forEach(o => o.visible = e.target.checked));
            document.getElementById('showNames').addEventListener('change', e => labels.forEach(l => l.div.style.display = e.target.checked ? 'block' : 'none'));
            document.addEventListener('keydown', e => { if (e.code === 'Space') isPaused = !isPaused; });

            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            renderer.domElement.addEventListener('click', e => {
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(celestialObjects);
                if (intersects.length > 0) showPlanetInfo(intersects[0].object);
            });

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        function showPlanetInfo(planet) {
            const infoDiv = document.getElementById('planetDetails');
            let html = 'Selecteer een object.';

            if (planet === sun) {
                html = `<h4>‚òÄÔ∏è Zon</h4><p>${sunFacts}</p>`;
            } else if (planet.userData && planet.userData.facts) {
                const data = planet.userData;
                const emoji = data.type === 'dwarf' ? '‚òÑÔ∏è' : 'ü™ê';
                html = `<h4 style="color:#${data.color.toString(16)}">${emoji} ${data.name}</h4><p>${data.facts}</p>`;
            }
            infoDiv.innerHTML = html;
        }

        function updateLabels() {
            labels.forEach(labelData => {
                const { div, object } = labelData;
                const pos = new THREE.Vector3();
                object.getWorldPosition(pos);
                pos.project(camera);
                const x = (pos.x * 0.5 + 0.5) * window.innerWidth;
                const y = (pos.y * -0.5 + 0.5) * window.innerHeight;
                // Verberg label als het achter de camera is
                div.style.display = (pos.z < 1 && document.getElementById('showNames').checked) ? 'block' : 'none';
                div.style.transform = `translate(-50%, -150%) translate(${x}px, ${y}px)`;
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);

            if (!isPaused) {
                const speedFactor = 0.1 * animationSpeed;
                sun.rotation.y += 0.001 * animationSpeed;

                celestialObjects.forEach(obj => {
                    if (!obj.userData.distance) return;
                    const data = obj.userData;
                    data.angle += (data.speed * 0.01 * speedFactor);
                    obj.position.set(Math.cos(data.angle) * data.distance, 0, Math.sin(data.angle) * data.distance);
                    obj.rotation.y += data.rotationSpeed * animationSpeed;

                    if (data.moons) {
                        data.moons.forEach(moonData => {
                            moonData.angle += (moonData.speed * 0.01 * speedFactor);
                            moonData.mesh.position.set(Math.cos(moonData.angle) * moonData.distance, 0, Math.sin(moonData.angle) * moonData.distance);
                        });
                    }
                });
                
                asteroids.forEach(asteroid => {
                    const data = asteroid.userData;
                    data.angle += (data.speed * 0.01 * speedFactor);
                    asteroid.position.x = Math.cos(data.angle) * data.distance;
                    asteroid.position.z = Math.sin(data.angle) * data.distance;
                    asteroid.rotation.x += 0.01 * animationSpeed;
                    asteroid.rotation.y += 0.01 * animationSpeed;
                });
            }

            controls.update();
            updateLabels();
            renderer.render(scene, camera);
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>