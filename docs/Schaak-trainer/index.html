<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptieve Schaak Trainer</title>
    
    <!-- Externe Bibliotheken -->
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* ===== HIER STAAT ALLE CSS INGEBOUWD ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a202c; /* Donkerblauw/grijs thema */
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 1500px;
            margin: 0 auto;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2d3748;
            padding: 15px 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #4a5568;
        }

        .app-header h1 {
            color: #e2e8f0;
            font-size: 1.8em;
            font-weight: 700;
        }

        .app-header h1 i {
            color: #63b3ed;
            margin-right: 12px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1em;
        }

        .rating {
            background: #63b3ed;
            color: #1a202c;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
        }

        .game-container {
            display: grid;
            grid-template-columns: minmax(280px, 1fr) auto minmax(280px, 1fr);
            gap: 20px;
            align-items: start;
        }

        .control-panel, .analysis-panel {
            background: #2d3748;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #4a5568;
        }

        .game-info h3, .progress-section h3, .move-history h3, .live-analysis h3 {
            color: #cbd5e0;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 5px;
            font-size: 1.1em;
        }

        .game-controls {
            margin: 25px 0;
        }

        .btn {
            width: 100%;
            padding: 14px;
            margin-bottom: 12px;
            border: 1px solid #63b3ed;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: #63b3ed;
            color: #1a202c;
        }

        .btn-primary:hover {
            background: #90cdf4;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(99, 179, 237, 0.2);
        }

        .btn-secondary {
            background: transparent;
            color: #63b3ed;
        }

        .btn-secondary:hover {
            background: rgba(99, 179, 237, 0.1);
            transform: translateY(-2px);
        }

        .skill-meter { margin-bottom: 15px; }
        .skill-meter span { display: block; margin-bottom: 8px; font-size: 1em; color: #a0aec0; }
        .progress-bar { height: 10px; background: #1a202c; border-radius: 5px; overflow: hidden; border: 1px solid #4a5568;}
        .progress-fill { height: 100%; background: #48bb78; border-radius: 5px; transition: width 0.5s ease; }

        .board-container {
            background: #2d3748;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #4a5568;
        }

        #chessboard {
            width: 65vh;
            max-width: 100%;
            max-height: 80vh;
            aspect-ratio: 1 / 1;
        }

        .moves-list { max-height: 220px; overflow-y: auto; background: #1a202c; border-radius: 8px; padding: 15px; margin-bottom: 20px; font-family: 'Courier New', Courier, monospace; font-size: 1em; line-height: 1.6; border: 1px solid #4a5568;}
        .evaluation { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .eval-bar { flex: 1; height: 25px; background: #1a202c; border-radius: 5px; position: relative; overflow: hidden; border: 1px solid #4a5568;}
        .eval-fill { height: 100%; background: #48bb78; transition: all 0.3s ease; width: 50%; }
        #eval-score { font-weight: 700; color: #e2e8f0; min-width: 60px; font-size: 1.1em;}
        .suggestion { background: rgba(99, 179, 237, 0.1); border-left: 4px solid #63b3ed; padding: 15px; border-radius: 6px; font-size: 1em; color: #e2e8f0; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); }
        .modal-content { background-color: #2d3748; color: #e2e8f0; margin: 10% auto; border-radius: 12px; width: 90%; max-width: 600px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: modalSlideIn 0.3s ease; border: 1px solid #4a5568; }
        @keyframes modalSlideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { display:flex; justify-content:space-between; align-items:center; padding: 25px 30px; border-bottom: 1px solid #4a5568; }
        .modal-header h2 { color: #e2e8f0; font-size: 1.5em; }
        .close { font-size: 32px; font-weight: bold; cursor: pointer; color: #a0aec0; transition: color 0.2s;}
        .close:hover { color: #fff; }
        .modal-body { padding: 30px; }
        .modal-footer { padding: 20px 30px; border-top: 1px solid #4a5568; text-align: right; }

        @media (max-width: 1200px) {
            .game-container { grid-template-columns: 1fr; }
            .board-container { order: 1; }
            .control-panel { order: 2; }
            .analysis-panel { order: 3; }
            #chessboard { width: 100%; max-width: 600px; height: auto; margin: 0 auto; }
        }

        @media (max-width: 600px) {
            body { padding: 10px; }
            .app-header { flex-direction: column; gap: 15px; text-align: center; }
        }
        
        /* DEZE STYLES ZIJN CRUCIAAL VOOR CLICK-TO-MOVE */
        .highlight-selected {
            box-shadow: inset 0 0 4px 4px rgba(99, 179, 237, 0.7) !important;
        }

        .highlight-legal {
            background-color: rgba(4, 211, 97, 0.2);
            border-radius: 50%;
            box-shadow: inset 0 0 5px 2px rgba(4, 211, 97, 0.4);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1><i class="fas fa-chess"></i> Schaak Trainer</h1>
            <div class="player-info">
                <span id="player-name">Speler</span>
                <span id="player-rating" class="rating">1200</span>
            </div>
        </header>

        <!-- Main Game Area -->
        <main class="game-container">
            <!-- Left Panel: Game Controls -->
            <aside class="control-panel">
                <div class="game-info">
                    <h3>Partij Info</h3>
                    <div class="info-item"><span>Niveau:</span><span id="ai-level">Beginner</span></div>
                    <div class="info-item"><span>Zetten:</span><span id="move-count">0</span></div>
                    <div class="info-item"><span>Status:</span><span id="game-status">Aan de beurt</span></div>
                </div>

                <div class="game-controls">
                    <button id="new-game-btn" class="btn btn-primary"><i class="fas fa-play"></i> Nieuwe Partij</button>
                    <button id="hint-btn" class="btn btn-secondary"><i class="fas fa-lightbulb"></i> Hint</button>
                    <button id="undo-btn" class="btn btn-secondary"><i class="fas fa-undo"></i> Ongedaan maken</button>
                </div>

                <div class="progress-section">
                    <h3>Voortgang</h3>
                    <div class="skill-meter"><span>Tactiek</span><div class="progress-bar"><div id="tactical-progress" class="progress-fill" style="width: 60%"></div></div></div>
                    <div class="skill-meter"><span>Positiespel</span><div class="progress-bar"><div id="positional-progress" class="progress-fill" style="width: 45%"></div></div></div>
                    <div class="skill-meter"><span>Eindspel</span><div class="progress-bar"><div id="endgame-progress" class="progress-fill" style="width: 30%"></div></div></div>
                </div>
            </aside>

            <!-- Center: Chess Board -->
            <div class="board-container">
                <div id="chessboard"></div>
            </div>

            <!-- Right Panel: Analysis & Feedback -->
            <aside class="analysis-panel">
                <div class="move-history">
                    <h3>Zetten</h3>
                    <div id="pgn-moves" class="moves-list"></div>
                </div>

                <div class="live-analysis">
                    <h3>Live Analyse</h3>
                    <div id="position-evaluation" class="evaluation">
                        <div class="eval-bar"><div id="eval-indicator" class="eval-fill"></div></div>
                        <span id="eval-score">+0.0</span>
                    </div>
                    <div id="best-move" class="suggestion"></div>
                </div>
            </aside>
        </main>

        <!-- Feedback Modal -->
        <div id="feedback-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header"><h2 class="modal-title">Partij Analyse</h2><span class="close">&times;</span></div>
                <div class="modal-body">
                    <div id="game-summary"></div>
                    <div id="strengths-weaknesses"></div>
                    <div id="improvement-tips"></div>
                </div>
                <div class="modal-footer"><button id="continue-btn" class="btn btn-primary">Volgende Partij</button></div>
            </div>
        </div>
    </div>

    <!-- JavaScript Bibliotheken -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    
    <script>
    // ===== HIER STAAT ALLE JAVASCRIPT LOGICA INGEBOUWD =====

    // --- player-profile.js ---
    class PlayerProfile {
        constructor() { this.profile = this.loadProfile(); this.initializeProfile(); }
        getDefaultProfile() { return { naam: "Speler", elo_rating: 1200, partijen_gespeeld: 0, tactische_score: 50, positionele_score: 40, eindspel_score: 30, partij_geschiedenis: [] }; }
        loadProfile() { const saved = localStorage.getItem('schaak_speler_profiel'); return saved ? JSON.parse(saved) : this.getDefaultProfile(); }
        saveProfile() { localStorage.setItem('schaak_speler_profiel', JSON.stringify(this.profile)); this.updateUI(); }
        initializeProfile() { this.updateUI(); }
        updateUI() { $('#player-name').text(this.profile.naam); $('#player-rating').text(this.profile.elo_rating); $('#tactical-progress').css('width', `${this.profile.tactische_score}%`); $('#positional-progress').css('width', `${this.profile.positionele_score}%`); $('#endgame-progress').css('width', `${this.profile.eindspel_score}%`);}
        processGameResult(gameData) { this.profile.partijen_gespeeld++; if (gameData.result === 'win') this.profile.elo_rating += 15; else if (gameData.result === 'loss') this.profile.elo_rating -= 10; this.saveProfile(); }
    }
    window.playerProfile = new PlayerProfile();

    // --- ai.js ---
    class ChessAI {
        setLevel(playerRating) { $('#ai-level').text(playerRating < 1400 ? 'Beginner' : 'Gevorderd'); }
        async getBestMove(fen) { const game = new Chess(fen); const moves = game.moves(); if (moves.length === 0) return null; return moves[Math.floor(Math.random() * moves.length)]; }
        evaluatePosition(fen) { const game = new Chess(fen); if (game.game_over()) return 0; const pieceValue = { p: 1, n: 3, b: 3, r: 5, q: 9 }; let score = 0; game.board().forEach(row => row.forEach(piece => { if (piece) { score += (pieceValue[piece.type] || 0) * (piece.color === 'w' ? 1 : -1); } })); return score; }
        async getHint(fen) { const move = await this.getBestMove(fen); return { move, explanation: "Dit is een goede zet." }; }
    }
    window.chessAI = new ChessAI();

    // --- analysis.js ---
    class GameAnalysis {
        constructor(history) { this.history = history; }
        async analyze() { return { blunders: Math.floor(Math.random() * 3), positional_mistakes: Math.floor(Math.random() * 5), best_move_found: Math.floor(Math.random() * 10) }; }
    }

    // --- feedback.js ---
    class FeedbackGenerator {
        constructor(analysis, profile) { this.analysis = analysis; this.profile = profile; }
        showFeedback() { $('#game-summary').html(`<h3>Samenvatting</h3><p>Je maakte ${this.analysis.blunders} blunders.</p>`); $('#feedback-modal').show(); }
        static closeFeedback() { $('#feedback-modal').hide(); }
    }
    window.FeedbackGenerator = FeedbackGenerator;

    // --- app.js (HOOFDLOGICA) ---
    document.addEventListener('DOMContentLoaded', () => {
        const ChessApp = {
            board: null, game: new Chess(), playerColor: 'w', selectedSquare: null,
            init() { this.setupBoard(); this.setupEventListeners(); this.startNewGame(); },
            setupBoard() {
                const config = { draggable: false, position: 'start', pieceTheme: 'assets/pieces/{piece}.png' };
                this.board = Chessboard('chessboard', config);
                $(window).resize(this.board.resize);
            },
            setupEventListeners() {
                $('#new-game-btn').on('click', this.startNewGame.bind(this));
                $('#undo-btn').on('click', this.undoMove.bind(this));
                $('#hint-btn').on('click', this.showHint.bind(this));
                $('.close').on('click', FeedbackGenerator.closeFeedback);
                $('#continue-btn').on('click', () => { FeedbackGenerator.closeFeedback(); this.startNewGame(); });
                $('#chessboard').on('click', '.square-55d63', this.handleSquareClick.bind(this));
            },
            handleSquareClick(e) {
                if (this.game.game_over()) return;
                const square = $(e.currentTarget).data('square');
                if (this.selectedSquare) {
                    const move = { from: this.selectedSquare, to: square, promotion: 'q' };
                    const result = this.game.move(move);
                    if (result) {
                        this.board.position(this.game.fen());
                        this.clearHighlights();
                        this.selectedSquare = null;
                        this.updateGameInfo();
                        window.setTimeout(this.makeAIMove.bind(this), 250);
                    } else {
                        this.clearHighlights();
                        if (this.isPlayerPiece(square)) { this.selectSquare(square); } 
                        else { this.selectedSquare = null; }
                    }
                } else { if (this.isPlayerPiece(square)) { this.selectSquare(square); } }
            },
            isPlayerPiece(square) { const piece = this.game.get(square); return piece && piece.color === this.playerColor && piece.color === this.game.turn(); },
            selectSquare(square) { this.selectedSquare = square; this.highlightLegalMoves(square); },
            highlightLegalMoves(square) {
                this.clearHighlights();
                const moves = this.game.moves({ square: square, verbose: true });
                if (moves.length === 0) return;
                $(`.square-${square}`).addClass('highlight-selected');
                moves.forEach(move => { $(`.square-${move.to}`).addClass('highlight-legal'); });
            },
            clearHighlights() { $('#chessboard .square-55d63').removeClass('highlight-selected highlight-legal'); },
            startNewGame() { this.game.reset(); this.board.position(this.game.fen()); this.clearHighlights(); this.selectedSquare = null; window.chessAI.setLevel(window.playerProfile.profile.elo_rating); this.updateGameInfo(); },
            async makeAIMove() { if (this.game.game_over()) return; const move = await window.chessAI.getBestMove(this.game.fen()); if (move) { this.game.move(move); this.board.position(this.game.fen()); this.updateGameInfo(); } },
            undoMove() { this.game.undo(); this.game.undo(); this.board.position(this.game.fen()); this.clearHighlights(); this.selectedSquare = null; this.updateGameInfo(); },
            async showHint() { const hint = await window.chessAI.getHint(this.game.fen()); if (hint) { $('#best-move').html(`<strong>Hint:</strong> ${hint.move} - <em>${hint.explanation}</em>`); } },
            updateGameInfo() {
                const statusEl = $('#game-status');
                let statusText = this.game.turn() === 'w' ? 'Wit is aan zet' : 'Zwart is aan zet';
                if (this.game.in_checkmate()) { statusText = `Schaakmat! ${this.game.turn() === 'w' ? 'Zwart' : 'Wit'} wint.`; this.endGame('loss'); } 
                else if (this.game.in_draw()) { statusText = 'Remise!'; this.endGame('draw'); } 
                else if (this.game.in_check()) { statusText += ', schaak!'; }
                statusEl.text(statusText);
                $('#pgn-moves').html(this.game.pgn({ max_width: 5, newline_char: '<br>' }));
                $('#move-count').text(this.game.history().length);
                const evaluation = window.chessAI.evaluatePosition(this.game.fen());
                $('#eval-score').text(evaluation.toFixed(1));
                const evalPercent = 50 + (evaluation * 10);
                $('#eval-indicator').css('width', `${Math.max(0, Math.min(100, evalPercent))}%`);
            },
            async endGame(result) {
                const analysis = new GameAnalysis(this.game.history({ verbose: true }));
                const analysisResult = await analysis.analyze();
                const gameData = { result: result, moveCount: this.game.history().length, pgn: this.game.pgn(), analysis: analysisResult };
                window.playerProfile.processGameResult(gameData);
                const feedback = new FeedbackGenerator(analysisResult, window.playerProfile.profile);
                feedback.showFeedback();
            }
        };
        ChessApp.init();
    });
    </script>
</body>
</html>

